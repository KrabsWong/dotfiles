#启用鼠标模式
set -g mouse on
setw -g mode-keys vi

# --- 基础样式 ---
# 移除背景色块，使用极深色背景（接近透明），文字使用淡紫色/淡白色
set -g status-style "bg=#1e1e2e,fg=#a9b1d6"

# --- 左侧 (Status Left) ---
# 样式: " ❐ SessionName |"
# 颜色: 蓝色图标 + 粗体文字
set -g status-left-length 50
set -g status-left "#[fg=#82aaff,bold] ❐ #S #[fg=#444444]|"

# --- 中间 (Window List) ---
# 正在激活的窗口: 绿色高亮 + 加粗
set -g window-status-current-format "#[fg=#c3e88d,bold] #I:#W "
# 其他后台窗口: 深灰蓝色，低调显示
set -g window-status-format "#[fg=#545c7e] #I:#W "
# 窗口之间的分隔符
set -g window-status-separator "#[fg=#444444]|"

# --- 右侧 (Status Right) ---
# 样式: "Git Branch | ⏰ Date Time"
# 1. Git: 紫色 (自动隐藏)
# 2. Time: 蓝色
set -g status-interval 1
set -g status-right-length 120
set -g status-right "#(bash $HOME/Personal/dotfiles/tmux/git_status.sh '#{pane_current_path}') #[fg=#444444]| #[fg=#82aaff]⏰ %Y-%m-%d %H:%M:%S "

# --- 消息与命令行样式 (Message & Command) ---
# 输入命令(:)或重命名时的样式：深蓝灰底 + 亮蓝字
set -g message-style "bg=#3b4261,fg=#82aaff"
set -g message-command-style "bg=#3b4261,fg=#82aaff"

# --- 模式选择样式 (Mode Style) ---
# 复制模式/选择文本时的样式
set -g mode-style "bg=#3b4261,fg=#82aaff"

# --- 分屏边框样式 (Pane Borders) ---
# 非激活窗格边框：深灰
set -g pane-border-style "fg=#444444"
# 激活窗格边框：亮蓝，方便识别当前在哪
set -g pane-active-border-style "fg=#82aaff"

# (可选) 调整鼠标滚轮每次滚动的行数，默认是5行
bind -T copy-mode-vi WheelUpPane send-keys -X -N 2 scroll-up
bind -T copy-mode-vi WheelDownPane send-keys -X -N 2 scroll-down

# 调整 leader 命令
set -g prefix C-Space
unbind C-b
bind C-Space send-prefix


## 分屏快捷键
# 垂直分屏 (Vertical split)
bind | split-window -h -c "#{pane_current_path}"
# 水平分屏 (Horizontal split)
bind - split-window -v -c "#{pane_current_path}"

# --- 统一 Kitty 风格分屏 ---
# d = 左右分屏 (对应 Kitty cmd+d)
bind d split-window -h -c "#{pane_current_path}"

# D (Shift+d) = 上下分屏 (对应 Kitty shift+cmd+d)
bind D split-window -v -c "#{pane_current_path}"

# 将 y 键绑定为：复制选中文本 -> 传输给 pbcopy -> 取消选择模式
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# 绑定 Ctrl+f - 视觉优化版：彩色分列显示 (Tab分隔，更稳定)
bind-key -n C-f display-popup -E 'tmux list-windows -a -F "#{session_name}:#{window_index}|#{session_name}|#{window_index}|#{window_name}" | awk -F "|" "{printf \"%s\t\033[36m%-12s\033[0m \033[33m%3s\033[0m : %s\n\", \$1, \$2, \$3, \$4}" | fzf --ansi --reverse --delimiter="\t" --with-nth=2.. --header "  SESSION      IDX : WINDOW" | cut -f1 | xargs tmux switch-client -t'

# --- 自动命名优化 ---
# 1. 自动重命名窗口为“首字母缩写路径” (例如: ~/Personal/code -> ~/P/c/code)
set-option -g status-interval 1
set-option -g automatic-rename on
# 逻辑：先替换HOME为~，然后将所有"中间目录"替换为首字母+斜杠，保留最后一个文件名完整
set-option -g automatic-rename-format '#{s|/([^/])[^/]+/|/\1/|g:#{s|$HOME|~|:pane_current_path}}'

# 2. 关闭窗口后，自动重新编号 (防止出现 1, 3, 4 这种空缺)
set-option -g renumber-windows on
