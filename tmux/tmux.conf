# --- 1. Core Settings / 核心设置 ---

# 将前缀键修改为 Ctrl+a (更易按)
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# 启用鼠标支持 (点击切换窗口/窗格，调整大小)
set -g mouse on

# 使用 Vi 模式进行复制/导航
setw -g mode-keys vi

# 关闭窗口后自动重新编号 (防止出现 1, 3, 4 空缺)
set-option -g renumber-windows on

# 状态栏刷新频率 (秒)
set -g status-interval 1


# --- 2. Key Bindings / 快捷键 ---

# 垂直分屏 (Vertical) - 保持当前路径
bind | split-window -h -c "#{pane_current_path}"
# 水平分屏 (Horizontal) - 保持当前路径
bind - split-window -v -c "#{pane_current_path}"

# Kitty 风格快捷键兼容
# d = 左右分屏
bind d split-window -h -c "#{pane_current_path}"
# D (Shift+d) = 上下分屏
bind D split-window -v -c "#{pane_current_path}"

# 鼠标滚轮速度优化 (每次滚2行)
bind -T copy-mode-vi WheelUpPane send-keys -X -N 2 scroll-up
bind -T copy-mode-vi WheelDownPane send-keys -X -N 2 scroll-down

# 'y' 键复制到系统剪贴板 (pbcopy) 并退出模式
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Ctrl+f: 模糊搜索切换窗口 (FZF Popup)
bind-key -n C-f display-popup -E 'tmux list-windows -a -F "#{session_name}:#{window_index}|#{session_name}|#{window_index}|#{window_name}" | awk -F "|" "{printf \"%s\t\033[36m%-12s\033[0m \033[33m%3s\033[0m : %s\n\", \$1, \$2, \$3, \$4}" | fzf --ansi --reverse --delimiter="\t" --with-nth=2.. --header "  SESSION      IDX : WINDOW" | cut -f1 | xargs tmux switch-client -t'


# --- 3. Appearance / 外观样式 ---

# 基础背景色 (极深色/接近透明)
set -g status-style "bg=#1e1e2e,fg=#a9b1d6"

# 左侧: 蓝色图标 + Session名
set -g status-left-length 50
set -g status-left "#[fg=#82aaff,bold] ❐ #S #[fg=#444444]|"

# 中间: 窗口列表
set -g window-status-separator "#[fg=#444444]|"
# 当前激活窗口: 绿色高亮 + 加粗
set -g window-status-current-format "#[fg=#c3e88d,bold] #I:#W "
# 后台窗口: 深灰蓝
set -g window-status-format "#[fg=#545c7e] #I:#W "

# 右侧: Git状态 (脚本) | 时间
set -g status-right-length 120
set -g status-right "#(bash $HOME/Personal/dotfiles/tmux/git_status.sh '#{pane_current_path}') #[fg=#444444]| #[fg=#82aaff]⏰ %Y-%m-%d %H:%M:%S "

# 界面元素颜色
set -g pane-border-style "fg=#444444"
set -g pane-active-border-style "fg=#82aaff"
set -g message-style "bg=#3b4261,fg=#82aaff"
set -g message-command-style "bg=#3b4261,fg=#82aaff"
set -g mode-style "bg=#3b4261,fg=#82aaff"


# --- 4. Automation / 自动化逻辑 ---

# 自动重命名窗口
set-option -g automatic-rename on
# 智能缩写路径 (例如: ~/Personal/code -> ~/P/c/code)
set-option -g automatic-rename-format '#{s|/([^/])[^/]+/|/\1/|g:#{s|$HOME|~|:pane_current_path}}'
